<div class="validate-2fa-container">
  <div class="validate-card-wrapper">
    <nz-card class="validate-card" [nzBordered]="true">
      <!-- Header -->
      <div class="validate-header">
        <div class="icon-container">
          <i nz-icon nzType="safety-certificate" nzTheme="outline" class="validate-icon"></i>
        </div>
        <h1>Autenticación de Dos Factores</h1>
        <p class="subtitle">Ingresa el código de tu aplicación autenticadora</p>
        <p class="user-email">{{ correo }}</p>
      </div>

      <!-- Mensaje de error -->
      <nz-alert
        *ngIf="errorMessage"
        nzType="error"
        [nzMessage]="errorMessage"
        nzShowIcon
        nzCloseable
        (nzOnClose)="errorMessage = ''"
        class="error-alert"
      ></nz-alert>

      <!-- Formulario de validación -->
      <form nz-form [formGroup]="validateForm" (ngSubmit)="onSubmit()" class="validate-form">
        <!-- Campo código 2FA -->
        <nz-form-item>
          <nz-form-label [nzRequired]="true" nzFor="code">
            Código de 6 dígitos
          </nz-form-label>
          <nz-form-control [nzErrorTip]="codeErrorTpl">
            <nz-input-group nzPrefixIcon="number" nzSize="large">
              <input
                nz-input
                type="text"
                id="code"
                formControlName="codigo2FA"
                placeholder="000000"
                maxlength="6"
                [disabled]="loading"
                (input)="onCodeInput($event)"
                class="code-input"
                autocomplete="off"
              />
            </nz-input-group>
            <ng-template #codeErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">
                Por favor ingrese el código 2FA
              </ng-container>
              <ng-container *ngIf="control.hasError('pattern') || control.hasError('minlength')">
                El código debe ser de 6 dígitos
              </ng-container>
            </ng-template>
          </nz-form-control>
        </nz-form-item>

        <!-- Instrucciones -->
        <div class="instructions">
          <p>
            <i nz-icon nzType="info-circle" nzTheme="outline"></i>
            Abre tu aplicación autenticadora (Google Authenticator, Microsoft Authenticator, etc.) 
            e ingresa el código de 6 dígitos que aparece.
          </p>
        </div>

        <!-- Botones -->
        <nz-form-item class="validate-form-buttons">
          <div class="button-group">
            <button
              nz-button
              nzType="default"
              (click)="goBack()"
              [disabled]="loading"
              type="button"
            >
              <i nz-icon nzType="arrow-left"></i>
              Volver
            </button>
            <button
              nz-button
              nzType="primary"
              [nzLoading]="loading"
              [disabled]="loading || !validateForm.valid"
              type="submit"
            >
              <span *ngIf="!loading">Validar</span>
              <span *ngIf="loading">Validando...</span>
            </button>
          </div>
        </nz-form-item>
      </form>

      <!-- Footer info -->
      <div class="validate-footer">
        <p class="help-text">
          <i nz-icon nzType="question-circle" nzTheme="outline"></i>
          ¿No tienes acceso a tu dispositivo? 
          <a routerLink="/login/reset-2fa">Recuperar 2FA</a>
        </p>
      </div>
    </nz-card>
  </div>
</div>
